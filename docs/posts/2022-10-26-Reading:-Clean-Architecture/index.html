<!doctype html><html><head><title>Reading: Clean Architecture | ðŸ“’ Functional Fieldnotes</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.1/highlight.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.1/languages/elm.min.js"></script><script>hljs.initHighlightingOnLoad();</script><link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.1/styles/default.min.css" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Open+Sans|Proza+Libre|Inconsolata" rel="stylesheet" type="text/css"></head><body><div style="display: flex; flex-direction: row; flex-wrap: wrap; justify-content: space-between; align-items: center;" class="navigation"><div style="display: flex;"><a href="/posts">ðŸ“’ Functional Fieldnotes</a></div><div style="display: flex; flex-direction: row; flex-wrap: wrap; gap: 16px;"></div></div><div class="sidebar"><div style="display: flex; flex-direction: column; padding: 8px; float: right;"><h2>Posts</h2><ul><li><a href="/posts/2023-02-15-Writing-View-APIs">Writing View APIs</a></li><li><a href="/posts/2022-12-10-Designing-A-Type">Designing A Type</a></li><li><a href="/posts/2022-11-10-c4-vs">C4 Vs</a></li><li><a href="/posts/2022-10-26-Reading:-Clean-Architecture">Reading: Clean Architecture</a></li><li><a href="/posts/2022-10-20-Reading:-The-Clean-Coder">Reading: The Clean Coder</a></li><li><a href="/posts/2022-10-19-Reading:-Clean-Code">Reading: Clean Code</a></li><li><a href="/posts/2022-10-19-Comparing-Elm-With-Kotlin">Comparing Elm With Kotlin</a></li><li><a href="/posts/2022-10-11-formal-methods,-type-theory-and-the-real-world">Formal Methods, Type Theory And The Real World</a></li><li><a href="/posts/2022-10-11-Relearn-CSS">Relearn CSS</a></li><li><a href="/posts/2022-10-08-investigating-design-patterns">Investigating Design Patterns</a></li><li><a href="/posts/2022-10-06-functional-design-patterns">Functional Design Patterns</a></li><li><a href="/posts/2022-10-06-exploring-monads">Exploring Monads</a></li><li><a href="/posts/2022-10-05-simple-software">Simple Software</a></li><li><a href="/posts/2022-09-22-Some-Thoughts-on-TDD">Some Thoughts On TDD</a></li><li><a href="/posts/2022-09-18-Tracery-Language">Tracery Language</a></li><li><a href="/posts/2022-07-27-Terminology-Overview">Terminology Overview</a></li><li><a href="/posts/2022-05-29-Reading:-The-Pragmatic-Programmer">Reading: The Pragmatic Programmer</a></li></ul></div></div><div class="sidebar2"><div style="display: flex; flex-direction: column; position: sticky; top: 0px; padding: 8px;"><h2>Table of Content</h2><ol><li><a href="#What_is_Design_and_Architecture">What is Design and Architecture</a><ol></ol></li><li><a href="#A_Tale_of_two_values">A Tale of two values</a><ol></ol></li><li><a href="#Paradigm_Overview">Paradigm Overview</a><ol><li><a href="#Structured_Programmings">Structured Programmings</a><ol></ol></li><li><a href="#Object_Oriented_Programming">Object Oriented Programming</a><ol></ol></li><li><a href="#Functional_Programming">Functional Programming</a><ol><li><a href="#Event_Sourcing">Event Sourcing</a><ol></ol></li></ol></li></ol></li><li><a href="#Design_Principles">Design Principles</a><ol><li><a href="#Single_Responsibility_Principle">Single Responsibility Principle</a><ol></ol></li><li><a href="#The_Open_Closed_Principle">The Open-Closed Principle</a><ol></ol></li><li><a href="#The_Liskov_substitution_principle">The Liskov substitution principle</a><ol></ol></li><li><a href="#The_Interface_Segregation_Principle">The Interface Segregation Principle</a><ol></ol></li></ol></li><li><a href="#Component_Principles">Component Principles</a><ol></ol></li><li><a href="#What_is_Architecture_">What is Architecture?</a><ol></ol></li><li><a href="#BUSINESS_RULES">BUSINESS RULES</a><ol></ol></li></ol></div></div><div class="content"><h1 class="title">Reading: Clean Architecture</h1><div class="post-metadata"><span>2022-10-26</span><span>â€¢</span><a href="/tags/functional programming">Functional Programming</a></div><div class="markdown"><h1 id="What_is_Design_and_Architecture">What is Design and Architecture</h1><blockquote><p>There is no difference between them. None at all.</p></blockquote><p>"Architecture" is used in context of high level. "Design" is more low level.</p><h1 id="A_Tale_of_two_values">A Tale of two values</h1><h1 id="Paradigm_Overview">Paradigm Overview</h1><p>Strucuted(Imperative) Programming, Object Oriented Programing and Functional Programming</p><h2 id="Structured_Programmings">Structured Programmings</h2><p>Not use <code>goto</code>, use <code>ifThenElse</code> and <code>while</code>/<code>for</code> instead.</p><h2 id="Object_Oriented_Programming">Object Oriented Programming</h2><p>Functions and variables should be grouped by the Objects that they transform.</p><h2 id="Functional_Programming">Functional Programming</h2><p>Functions should not change existing values.</p><blockquote><p>One of the most common compromises in regards to immutability is to separate the application into mutable and immutable components.</p></blockquote><h3 id="Event_Sourcing">Event Sourcing</h3><p>aka. Event Stream</p><p>Main Idea: Assume all events can be stored in a single list/stream.</p><p>You might not actually store everything for eternity and you might need a lot of storage to do so, but as a benefit you can work completely with pure functions.</p><h1 id="Design_Principles">Design Principles</h1><p>aka SOLID Principles</p><p>Solid principles look at groupings. (in OOP Objects, in PF namespaces and types).</p><p>SOLID Principles is about designing the interactions between groups - interfaces, types, compositions, inheritances.</p><h2 id="Single_Responsibility_Principle">Single Responsibility Principle</h2><p>A group should only ever have one common attribute.</p><p>The following type violated this principle.</p><pre><code>{-| Don't do this -}
type AnimalOrBuilding
    = Cat CatState
    | Dog DogState
    | Cinema CinemaState
    | Shop ShopState

toString : AnimalOrBuilding -&gt; String

isHungry : AnimalOrBuilding -&gt; Bool

isOpen : AnimalOrBuilding -&gt; Bool
</code></pre><p>Here we group things that are either animals or building. To fix this we need to understand why we need animals and building in the same type. Maybe we are creating a game and want to display both animals and buildings on the screen. After a bit of consideration we might come up with something like the following.</p><pre><code>type Entity
    = AnimalEntity Animal
    | BuildingEntity Building

type Animal
    = Cat CatState
    | Dog DogState

type Building
    = Cinema CinemaState
    | Shop ShopState

toString : Entity -&gt; String

isHungry : Animal -&gt; Bool

isOpen : Building -&gt; Bool
</code></pre><h2 id="The_Open_Closed_Principle">The Open-Closed Principle</h2><p>External groups should not be able to change design decisions.</p><p>Consider the following structure</p><pre><code>module Dog exposing (replaceAllDogs)

import World exposing (World)

replaceAllDogs : Dog -&gt; World -&gt; World
</code></pre><p>Here the module responsible for the dog can modify the world. Something like that is often the root cause of circular dependencies (<code>World</code> can modify <code>Dog</code> and <code>Dog</code> can modify <code>World</code>).</p><p>We should move <code>replaceAllDogs</code> into the <code>World</code> module. If we can't do this - for example because <code>World</code> is part of an external library - then we have to create an extension of the existing module.</p><pre><code>module World.Extra exposing (replaceAllAnimals)

replaceAllAnimals : Animal -&gt; World -&gt; World
</code></pre><h2 id="The_Liskov_substitution_principle">The Liskov substitution principle</h2><p>This principle states that the implementation should not change for subtypes.</p><p>Say we have a function that behaves seemingly completely different for Animals as for Buildings.</p><pre><code>type Entity
    = Animal { lastEaten : Food }
    | Building { people : List String }

add : String -&gt; Entity -&gt; Entity
add string entity =
    case entity of
        Animal _ -&gt;
            Animal {lastEaten = foodFromString string }
        Building {people} -&gt;
            Building {people = string :: people} 
</code></pre><p>This is bad design, as it requires the user to know the implemented behavior. So instead we should split this function and maybe also rename it to something more useful.</p><pre><code>feed : String -&gt; Entity -&gt; Maybe Entity
feed string entity =
    case entity of
        Animal _ -&gt;
            Just (Animal {lastEaten = foodFromString string })
        _ -&gt;
            Nothing

enter : Entity -&gt; Maybe Entity
enter entity =
    case entity of
        Building {people} -&gt;
            Just (Building {people = string :: people})
        _ -&gt;
            Nothing
</code></pre><h2 id="The_Interface_Segregation_Principle">The Interface Segregation Principle</h2><p>groups should only contain as little as possible.</p><p>Going back to the previous example of joining animals and buildings into entities. Now assume we want to be really smart and replace the custom type with a record.</p><pre><code>type alias Entity =
    { name : String
    , isOpen : Maybe Bool
    , isHungry : Maybe Bool
    }

isCat entity =
    entity.isHungry /= Nothing

isBuilding entity =
    entity.isOpen /= Nothing
</code></pre><p>Whenever we want to add or change a field related to cats, we would need to also check that the code related to buildings is still working.</p><p>So instead, we should only group the most necessary fields.</p><pre><code>type alias EntityState =
    { name : String
    , sort : EntitySort
    }

type EntitySort
    = Animal { isHungry : Bool }
    | Building { isOpen : Bool }
</code></pre><h1 id="Component_Principles">Component Principles</h1><p>Components are "files" of the program.</p><blockquote><p>Classes and modules that are grouped together into a component should be releaseable together.</p></blockquote><p>It does not specify how they should relate but instead, you should think about functions that live in the same file but are not related.</p><blockquote><p>a component should not have multiple reasons to change.</p></blockquote><p>Adding a small feature should effect just a single file.</p><blockquote><p>Classes and modules that tend to be reused together belong in the same component</p></blockquote><h1 id="What_is_Architecture_">What is Architecture?</h1><h1 id="BUSINESS_RULES">BUSINESS RULES</h1><hr><p>Did you like this post or want to share some thoughts? Then ping me on <a href="https://discourse.elm-lang.org/u/lucas_payr">Elm Discourse</a>.</p></div></div><div style="display: flex; flex-direction: row; flex-wrap: wrap; justify-content: space-between;" class="footer"><div style="display: flex;"></div><div style="display: flex; flex-direction: row; flex-wrap: wrap; gap: 16px; align-items: center;"><div style="display: flex;" class="link"><a href="https://www.linkedin.com/in/lucas-payr-8462911b9/">Build by Lucas Payr</a></div><div style="display: flex;" class="link"><a href="https://github.com/Orasund" style="display: flex; justify-content: center; align-items: center;"><svg width="32" height="32" viewbox="0 0 16 16"><path fill="#fff" d="
M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z
            "></path></svg></a></div><div style="display: flex;" class="link"><a href="https://twitter.com/edzgou" style="display: flex; justify-content: center; align-items: center;"><svg width="32" height="32" viewbox="0 0 16 16"><path fill="#fff" d="
M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809 c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z
            "></path></svg></a></div></div></div><link href="/styles.css" rel="stylesheet" type="text/css"><style>body {
    padding:0px;
    margin:0px;
    background-color:#fffbf8;
    color:#363636;
    font-family:Open Sans, Arial, sans-serif;
    font-size:18px;
    line-height:32px;
}

a {
    color:#348aa7;
    text-decoration:none;
}

code {
    font-family:Inconsolata, monospace;
    border-radius:8px;
}

h1, h2, h3, h4, h5, h6 {
    font-family:Proza Libre, Helvetica, sans-serif;
    line-height:32px;
    margin-left:-8px;
    margin-right:-8px;
}

.title {
    font-size:32px;
    margin-block-start:0px;
    margin-block-end:64px;
    height:inherit;
    padding-left:16px;
    padding-right:16px;
    margin-left:-24px;
    margin-right:-24px;
}

h1 {
    font-size:24px;
    border-bottom:1px solid #363636;
    margin-block-start:64px;
    margin-block-end:32px;
    box-sizing:border-box;
    height:32px;
}

h2 {
    font-size:22px;
    margin-bottom:0.80808rem;
    margin-block-start:32px;
    margin-block-end:32px;
}

h3, h5, h6 {
    font-size:1em;
    margin-block-start:32px;
    margin-block-end:0px;
}

small {
    font-size:65%;
}

ul {
    padding-inline-start:30px;
}

ol {
    padding-inline-start:30px;
}

p {
    margin-block-start:32px;
    margin-block-end:32px;
    text-align:justify;
}

.sidebar, .sidebar2 {
    font-size:0.9em;
    padding-top:64px;
}

.sidebar  h1, .sidebar  h2, .sidebar  h3, .sidebar2  h1, .sidebar2  h2, .sidebar2  h3 {
    margin:0;
}

.navigation {
    text-align:center;
    background-color:#a7e9ff;
    padding:16px;
}

.content {
    padding:32px 40px;
    background-image:linear-gradient(#a7e9ff 1px, transparent 0), linear-gradient(90deg, #a7e9ff 1px, transparent 0);
    background-size:32px 32px;
}

.footer {
    text-align:center;
    background-color:#348aa7;
    color:#ffffff;
    padding:16px;
}

.footer  a {
    color:#ffffff;
    text-decoration:none;
}

.footer  svg {
    padding-right:5px;
    vertical-align:baseline;
}

.post-metadata {
    height:32px;
    margin-top:32px;
    margin-bottom:32px;
}

.post-metadata  a, .post-metadata  span {
    display:inline-block;
    margin-right:5px;
}

.post-metadata  a {
    border-radius:16px;
    background-color:#348aa7;
    color:#fff;
    padding-left:8px;
    padding-right:8px;
    line-height:24px;
}</style></body></html>